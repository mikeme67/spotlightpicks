<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Product - Spotlight Picks</title>
<link rel="stylesheet" href="style.css">
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</head>
<body>
<div class="header">
  <div class="brand-left">
    <div class="profile-icon" id="topProfileBtn">P</div>
    <div class="logo" onclick="location.href='index.html'">Spotlight Picks</div>
  </div>
  <input id="searchInput" class="search-input" placeholder="Search...">
</div>

<div class="wrap container-card" id="productWrapper"></div>

<div class="bottom-nav">
  <button onclick="location.href='index.html'"><i class="fas fa-home icon-sm"></i>Home</button>
  <button onclick="location.href='activity.html'"><i class="fas fa-list icon-sm"></i>Activity</button>
  <button id="bottomProfileBtn"><i class="fas fa-user icon-sm"></i>Profile</button>
</div>

<script src="app.js"></script>
<script>
function q(name){ return new URL(location.href).searchParams.get(name) }
async function loadAndRender(){
  app.updateProfileButtons('topProfileBtn','bottomProfileBtn');
  app.setupSearch();
  const id = q('id') || q('temp');
  const p = id ? await app.renderProductPage(id) : null;
  const wrap = document.getElementById('productWrapper');
  if(!p){ wrap.innerHTML = '<div style="padding:30px;text-align:center">Product not found. <a href="index.html">Back</a></div>'; return; }

  // product layout
  wrap.innerHTML = `
    <div style="display:grid;grid-template-columns:1fr;gap:12px">
      <div class="viewer"><img id="mainImg" src="${app.escapeHtml(p.images[0]||'https://via.placeholder.com/800')}" alt=""></div>
      <div class="meta">
        <h2 style="margin:0">${app.escapeHtml(p.name)}</h2>
        <div style="margin-top:8px" class="price">${app.escapeHtml(p.price||'')}</div>
        <a class="btn-small" href="${app.escapeHtml(p.link||'#')}" target="_blank" style="margin-top:12px;display:inline-block">Buy from store</a>
        <div style="margin-top:12px">${app.escapeHtml(p.description||'')}</div>
      </div>
      <div class="reviews">
        <h3>Reviews</h3>
        <div id="reviewsList"></div>
        <div style="margin-top:12px">
          <input id="revName" placeholder="Your name" style="padding:8px;border-radius:8px;border:1px solid #eee;width:100%;margin-bottom:8px">
          <textarea id="revText" placeholder="Write your review" style="width:100%;padding:8px;border-radius:8px;border:1px solid #eee"></textarea>
          <button id="addReviewBtn" class="btn-small" style="background:var(--accent);color:#fff;margin-top:8px">Add Review</button>
        </div>
      </div>
    </div>
  `;

  // reviews stored per product id
  const key = 'reviews_' + p.id;
  let stored = JSON.parse(localStorage.getItem(key) || '[]');
  if((p.reviews||[]).length && stored.length===0){
    stored = (p.reviews||[]).map(r=>({name:'User',text:r,ts:Date.now()}));
    localStorage.setItem(key, JSON.stringify(stored));
  }
  function renderReviews(){
    const list = JSON.parse(localStorage.getItem(key) || '[]');
    const out = document.getElementById('reviewsList');
    out.innerHTML = list.length ? list.map(r=>`<div style="border-top:1px solid #f4d7e4;padding:8px 0"><strong>${app.escapeHtml(r.name)}</strong><div style="font-size:13px;color:#333">${app.escapeHtml(r.text)}</div></div>`).join('') : '<div style="color:#666">No reviews yet</div>';
  }
  renderReviews();
  document.getElementById('addReviewBtn').onclick = ()=>{
    const nm = document.getElementById('revName').value.trim() || 'Anonymous';
    const txt = document.getElementById('revText').value.trim();
    if(!txt) return alert('Write a review first');
    const arr = JSON.parse(localStorage.getItem(key) || '[]');
    arr.unshift({name:nm,text:txt,ts:Date.now()});
    localStorage.setItem(key, JSON.stringify(arr));
    document.getElementById('revName').value=''; document.getElementById('revText').value='';
    renderReviews();
  };
}
document.addEventListener('DOMContentLoaded', loadAndRender);
</script>
</body>
</html>
