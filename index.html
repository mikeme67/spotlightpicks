<script>
// Utility functions
function loadProducts(){ return JSON.parse(localStorage.getItem('products')||'[]'); }
function updateProfileButtons(topId,bottomId){
  const user = localStorage.getItem('userName');
  [topId,bottomId].forEach(id=>{
    const btn=document.getElementById(id);
    if(btn) btn.onclick = ()=>location.href = user?'profile.html':'signin.html';
  });
}

// Render products with animations
function renderCategories(filter=''){
  const products = loadProducts();
  const categories = ['hoodies','shirts','pants'];
  const container = document.getElementById('categoriesContainer');
  container.innerHTML='';

  categories.forEach(cat=>{
    const filtered = products.filter(p=>p.category===cat && p.name.toLowerCase().includes(filter.toLowerCase()));
    if(filtered.length===0) return;

    const section = document.createElement('div'); 
    section.className='category-section';
    section.innerHTML=`<div class="category-title">${cat.charAt(0).toUpperCase()+cat.slice(1)}</div>`;
    
    const row = document.createElement('div'); row.className='products-row';
    
    // Animate each product card
    filtered.forEach((p,i)=>{
      const card = document.createElement('div'); card.className='product-card';
      card.style.opacity=0;
      card.style.transform='translateY(20px)';
      card.innerHTML=`<img src="${p.images[0]||'https://via.placeholder.com/150'}" alt="${p.name}">
        <div class="product-name">${p.name}</div>
        <div class="product-price">${p.price||''}</div>`;
      card.onclick=()=>location.href=`product.html?id=${p.id}`;
      row.appendChild(card);
      
      // Animate card with stagger
      setTimeout(()=>{
        card.style.transition='0.5s ease-out';
        card.style.opacity=1;
        card.style.transform='translateY(0)';
      }, i*100);
    });

    section.appendChild(row); container.appendChild(section);
    setTimeout(()=>section.classList.add('visible'), 50); // fade-in section
  });
}

document.addEventListener('DOMContentLoaded',()=>{
  updateProfileButtons('topProfileBtn','bottomProfileBtn');
  renderCategories();

  document.getElementById('searchInput').addEventListener('input',(e)=>{
    renderCategories(e.target.value);
  });
});
</script>
